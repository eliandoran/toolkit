import{s as Vt,k as Jt,l as Rt,e as ht,a as $t,c as vt,b as gt,f as Je,g as Ct,o as st,i as xt,h as kt,m as zt}from"../chunks/scheduler.cQYGWxUu.js";import{S as Zt,i as Qt,c as Xe,a as Ke,m as et,t as tt,b as nt,d as rt,e as Lt}from"../chunks/index.mWZiJta3.js";import{c as jt,g as Xt}from"../chunks/_commonjsHelpers.Cpj98o6Y.js";import{C as Ft,t as Kt}from"../chunks/codemirror.R3x0elvO.js";import{j as Mt}from"../chunks/index.QyB7KJqh.js";import{T as en}from"../chunks/tool.zmLwkrsu.js";import{T as tn}from"../chunks/two-column-view.DPMxqJGK.js";import{S as It}from"../chunks/stack-view.mFxLKVrB.js";import{W as Wt}from"../chunks/warning-box.DjgLmEZY.js";function Ot(se){throw new Error('Could not dynamically require "'+se+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qt={exports:{}};(function(se,j){(function(S){se.exports=S()})(function(){return function(){function S(P,z,Y){function p(Z,M){if(!z[Z]){if(!P[Z]){var b=typeof Ot=="function"&&Ot;if(!M&&b)return b(Z,!0);if($)return $(Z,!0);var g=new Error("Cannot find module '"+Z+"'");throw g.code="MODULE_NOT_FOUND",g}var m=z[Z]={exports:{}};P[Z][0].call(m.exports,function(_){var q=P[Z][1][_];return p(q||_)},m,m.exports,S,P,z,Y)}return z[Z].exports}for(var $=typeof Ot=="function"&&Ot,ne=0;ne<Y.length;ne++)p(Y[ne]);return p}return S}()({1:[function(S,P,z){const Y=S("./utils"),p=function(){const $=Y.stringToArray,ne=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],Z=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],M=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],b=["Thousand","Million","Billion","Trillion"];function g(c,v){var l=function(D,E,y){var T="";if(D<=19)T=(E?" and ":"")+(y?Z[D]:ne[D]);else if(D<100){const re=Math.floor(D/10),ie=D%10;T=(E?" and ":"")+M[re-2],ie>0?T+="-"+l(ie,!1,y):y&&(T=T.substring(0,T.length-1)+"ieth")}else if(D<1e3){const re=Math.floor(D/100),ie=D%100;T=(E?", ":"")+ne[re]+" Hundred",ie>0?T+=l(ie,!0,y):y&&(T+="th")}else{var L=Math.floor(Math.log10(D)/3);L>b.length&&(L=b.length);const re=Math.pow(10,L*3),ie=Math.floor(D/re),R=D-ie*re;T=(E?", ":"")+l(ie,!1,!1)+" "+b[L-1],R>0?T+=l(R,!0,y):y&&(T+="th")}return T},k=l(c,!1,v);return k}const m={};ne.forEach(function(c,v){m[c.toLowerCase()]=v}),Z.forEach(function(c,v){m[c.toLowerCase()]=v}),M.forEach(function(c,v){const l=c.toLowerCase();m[l]=(v+2)*10,m[l.substring(0,c.length-1)+"ieth"]=m[l]}),m.hundredth=100,b.forEach(function(c,v){const l=c.toLowerCase(),k=Math.pow(10,(v+1)*3);m[l]=k,m[l+"th"]=k});function _(c){const l=c.split(/,\s|\sand\s|[\s\\-]/).map(E=>m[E]);let k=[0];return l.forEach(E=>{if(E<100){let y=k.pop();y>=1e3&&(k.push(y),y=0),k.push(y+E)}else k.push(k.pop()*E)}),k.reduce((E,y)=>E+y,0)}const q=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],we={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function me(c){for(var v=0;v<q.length;v++){const l=q[v];if(c>=l[0])return l[1]+me(c-l[0])}return""}function B(c){for(var v=0,l=1,k=c.length-1;k>=0;k--){const D=c[k],E=we[D];E<l?v-=E:(l=E,v+=E)}return v}function w(c,v){for(var l=[],k=v.charCodeAt(0);c>0;)l.unshift(String.fromCharCode((c-1)%26+k)),c=Math.floor((c-1)/26);return l.join("")}function J(c,v){for(var l=v.charCodeAt(0),k=0,D=0;D<c.length;D++)k+=(c.charCodeAt(c.length-D-1)-l+1)*Math.pow(26,D);return k}function C(c,v){if(typeof c>"u")return;c=Math.floor(c);const l=ue(v);return U(c,l)}const h={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},O={UPPER:"upper",LOWER:"lower",TITLE:"title"};function U(c,v){let l;const k=c<0;switch(c=Math.abs(c),v.primary){case h.LETTERS:l=w(c,v.case===O.UPPER?"A":"a");break;case h.ROMAN:l=me(c),v.case===O.UPPER&&(l=l.toUpperCase());break;case h.WORDS:l=g(c,v.ordinal),v.case===O.UPPER?l=l.toUpperCase():v.case===O.LOWER&&(l=l.toLowerCase());break;case h.DECIMAL:l=""+c;var D=v.mandatoryDigits-l.length;if(D>0){var E=new Array(D+1).join("0");l=E+l}if(v.zeroCode!==48&&(l=$(l).map(re=>String.fromCodePoint(re.codePointAt(0)+v.zeroCode-48)).join("")),v.regular){const re=Math.floor((l.length-1)/v.groupingSeparators.position);for(let ie=re;ie>0;ie--){const R=l.length-ie*v.groupingSeparators.position;l=l.substr(0,R)+v.groupingSeparators.character+l.substr(R)}}else v.groupingSeparators.reverse().forEach(re=>{const ie=l.length-re.position;l=l.substr(0,ie)+re.character+l.substr(ie)});if(v.ordinal){var y={1:"st",2:"nd",3:"rd"},T=l[l.length-1],L=y[T];(!L||l.length>1&&l[l.length-2]==="1")&&(L="th"),l=l+L}break;case h.SEQUENCE:throw{code:"D3130",value:v.token}}return k&&(l="-"+l),l}const ee=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function ue(c){const v={type:"integer",primary:h.DECIMAL,case:O.LOWER,ordinal:!1};let l,k;const D=c.lastIndexOf(";");switch(D===-1?l=c:(l=c.substring(0,D),k=c.substring(D+1),k[0]==="o"&&(v.ordinal=!0)),l){case"A":v.case=O.UPPER;case"a":v.primary=h.LETTERS;break;case"I":v.case=O.UPPER;case"i":v.primary=h.ROMAN;break;case"W":v.case=O.UPPER,v.primary=h.WORDS;break;case"Ww":v.case=O.TITLE,v.primary=h.WORDS;break;case"w":v.primary=h.WORDS;break;default:{let E=null,y=0,T=0,L=[],re=0;if($(l).map(R=>R.codePointAt(0)).reverse().forEach(R=>{let H=!1;for(let le=0;le<ee.length;le++){const I=ee[le];if(R>=I&&R<=I+9){if(H=!0,y++,re++,E===null)E=I;else if(I!==E)throw{code:"D3131"};break}}H||(R===35?(re++,T++):L.push({position:re,character:String.fromCodePoint(R)}))}),y>0){v.primary=h.DECIMAL,v.zeroCode=E,v.mandatoryDigits=y,v.optionalDigits=T;const H=function(le){if(le.length===0)return 0;const I=le[0].character;for(let Se=1;Se<le.length;Se++)if(le[Se].character!==I)return 0;const xe=le.map(Se=>Se.position),Ye=function(Se,Ne){return Ne===0?Se:Ye(Ne,Se%Ne)},Me=xe.reduce(Ye);for(let Se=1;Se<=xe.length;Se++)if(xe.indexOf(Se*Me)===-1)return 0;return Me}(L);H>0?(v.regular=!0,v.groupingSeparators={position:H,character:L[0].character}):(v.regular=!1,v.groupingSeparators=L)}else v.primary=h.SEQUENCE,v.token=l}}return v}const de={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function pe(c){var v=[];const l={type:"datetime",parts:v},k=function(H,le){if(le>H){let I=c.substring(H,le);I=I.split("]]").join("]"),v.push({type:"literal",value:I})}};for(var D=0,E=0;E<c.length;){if(c.charAt(E)==="["){if(c.charAt(E+1)==="["){k(D,E),v.push({type:"literal",value:"["}),E+=2,D=E;continue}if(k(D,E),D=E,E=c.indexOf("]",D),E===-1)throw{code:"D3135"};let H=c.substring(D+1,E);H=H.split(/\s+/).join("");var y={type:"marker",component:H.charAt(0)},T=H.lastIndexOf(","),L;if(T!==-1){const le=H.substring(T+1),I=le.indexOf("-");let xe,Ye;const Me=function(Ne){if(!(typeof Ne>"u"||Ne==="*"))return parseInt(Ne)};I===-1?xe=le:(xe=le.substring(0,I),Ye=le.substring(I+1));const Se={min:Me(xe),max:Me(Ye)};y.width=Se,L=H.substring(1,T)}else L=H.substring(1);if(L.length===1)y.presentation1=L;else if(L.length>1){var re=L.charAt(L.length-1);"atco".indexOf(re)!==-1?(y.presentation2=re,re==="o"&&(y.ordinal=!0),y.presentation1=L.substring(0,L.length-1)):y.presentation1=L}else y.presentation1=de[y.component];if(typeof y.presentation1>"u")throw{code:"D3132",value:y.component};if(y.presentation1[0]==="n")y.names=O.LOWER;else if(y.presentation1[0]==="N")y.presentation1[1]==="n"?y.names=O.TITLE:y.names=O.UPPER;else if("YMDdFWwXxHhmsf".indexOf(y.component)!==-1){var ie=y.presentation1;if(y.presentation2&&(ie+=";"+y.presentation2),y.integerFormat=ue(ie),y.width&&y.width.min!==void 0&&y.integerFormat.mandatoryDigits<y.width.min&&(y.integerFormat.mandatoryDigits=y.width.min),"YMD".indexOf(y.component)!==-1)if(y.n=-1,y.width&&y.width.max!==void 0)y.n=y.width.max,y.integerFormat.mandatoryDigits=y.n;else{var R=y.integerFormat.mandatoryDigits+y.integerFormat.optionalDigits;R>=2&&(y.n=R)}}(y.component==="Z"||y.component==="z")&&(y.integerFormat=ue(y.presentation1)),v.push(y),D=E+1}E++}return k(D,E),l}const ae=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Ae=["January","February","March","April","May","June","July","August","September","October","November","December"],Re=1e3*60*60*24,fe=function(c){const v=Date.UTC(c.year,c.month);var l=new Date(v).getUTCDay();return l===0&&(l=7),l>4?v+(8-l)*Re:v-(l-1)*Re},X=function(c,v){return{year:c,month:v,nextMonth:function(){return v===11?X(c+1,0):X(c,v+1)},previousMonth:function(){return v===0?X(c-1,11):X(c,v-1)},nextYear:function(){return X(c+1,v)},previousYear:function(){return X(c-1,v)}}},ze=function(c,v){return(v-c)/(Re*7)+1},V=(c,v)=>{let l;switch(v){case"Y":l=c.getUTCFullYear();break;case"M":l=c.getUTCMonth()+1;break;case"D":l=c.getUTCDate();break;case"d":{const k=Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),D=Date.UTC(c.getUTCFullYear(),0);l=(k-D)/Re+1;break}case"F":l=c.getUTCDay(),l===0&&(l=7);break;case"W":{const k=X(c.getUTCFullYear(),0),D=fe(k),E=Date.UTC(k.year,c.getUTCMonth(),c.getUTCDate());let y=ze(D,E);if(y>52){const T=fe(k.nextYear());E>=T&&(y=1)}else if(y<1){const T=fe(k.previousYear());y=ze(T,E)}l=Math.floor(y);break}case"w":{const k=X(c.getUTCFullYear(),c.getUTCMonth()),D=fe(k),E=Date.UTC(k.year,k.month,c.getUTCDate());let y=ze(D,E);if(y>4){const T=fe(k.nextMonth());E>=T&&(y=1)}else if(y<1){const T=fe(k.previousMonth());y=ze(T,E)}l=Math.floor(y);break}case"X":{const k=X(c.getUTCFullYear(),0),D=fe(k),E=fe(k.nextYear()),y=c.getTime();y<D?l=k.year-1:y>=E?l=k.year+1:l=k.year;break}case"x":{const k=X(c.getUTCFullYear(),c.getUTCMonth()),D=fe(k),E=k.nextMonth(),y=fe(E),T=c.getTime();T<D?l=k.previousMonth().month+1:T>=y?l=E.month+1:l=k.month+1;break}case"H":l=c.getUTCHours();break;case"h":l=c.getUTCHours(),l=l%12,l===0&&(l=12);break;case"P":l=c.getUTCHours()>=12?"pm":"am";break;case"m":l=c.getUTCMinutes();break;case"s":l=c.getUTCSeconds();break;case"f":l=c.getUTCMilliseconds();break;case"Z":case"z":break;case"C":l="ISO";break;case"E":l="ISO";break}return l};let Te=null;function qe(c,v,l){var k=0,D=0;if(typeof l<"u"){const ie=parseInt(l);k=Math.floor(ie/100),D=ie%100}var E=function(ie,R){var H=V(ie,R.component);if("YMDdFWwXxHhms".indexOf(R.component)!==-1)if(R.component==="Y"&&R.n!==-1&&(H=H%Math.pow(10,R.n)),R.names){if(R.component==="M"||R.component==="x")H=Ae[H-1];else if(R.component==="F")H=ae[H];else throw{code:"D3133",value:R.component};R.names===O.UPPER?H=H.toUpperCase():R.names===O.LOWER&&(H=H.toLowerCase()),R.width&&H.length>R.width.max&&(H=H.substring(0,R.width.max))}else H=U(H,R.integerFormat);else if(R.component==="f")H=U(H,R.integerFormat);else if(R.component==="Z"||R.component==="z"){const le=k*100+D;if(R.integerFormat.regular)H=U(le,R.integerFormat);else{const I=R.integerFormat.mandatoryDigits;if(I===1||I===2)H=U(k,R.integerFormat),D!==0&&(H+=":"+C(D,"00"));else if(I===3||I===4)H=U(le,R.integerFormat);else throw{code:"D3134",value:I}}le>=0&&(H="+"+H),R.component==="z"&&(H="GMT"+H),le===0&&R.presentation2==="t"&&(H="Z")}else R.component==="P"&&R.names===O.UPPER&&(H=H.toUpperCase());return H};let y;typeof v>"u"?(Te===null&&(Te=pe("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),y=Te):y=pe(v);const T=(60*k+D)*60*1e3,L=new Date(c+T);let re="";return y.parts.forEach(function(ie){ie.type==="literal"?re+=ie.value:re+=E(L,ie)}),re}function a(c){var v={};if(c.type==="datetime")v.type="datetime",v.parts=c.parts.map(function(l){var k={};if(l.type==="literal")k.regex=l.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if(l.component==="Z"||l.component==="z"){let E;Array.isArray(l.integerFormat.groupingSeparators)||(E=l.integerFormat.groupingSeparators),k.regex="",l.component==="z"&&(k.regex="GMT"),k.regex+="[-+][0-9]+",E&&(k.regex+=E.character+"[0-9]+"),k.parse=function(y){l.component==="z"&&(y=y.substring(3));let T=0,L=0;return E?(T=Number.parseInt(y.substring(0,y.indexOf(E.character))),L=Number.parseInt(y.substring(y.indexOf(E.character)+1))):y.length-1<=2?T=Number.parseInt(y):(T=Number.parseInt(y.substring(0,3)),L=Number.parseInt(y.substring(3))),T*60+L}}else if(l.integerFormat)l.integerFormat.n=l.n,k=a(l.integerFormat);else{k.regex="[a-zA-Z]+";var D={};if(l.component==="M"||l.component==="x")Ae.forEach(function(E,y){l.width&&l.width.max?D[E.substring(0,l.width.max)]=y+1:D[E]=y+1});else if(l.component==="F")ae.forEach(function(E,y){y>0&&(l.width&&l.width.max?D[E.substring(0,l.width.max)]=y:D[E]=y)});else if(l.component==="P")D={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:l.component};k.parse=function(E){return D[E]}}return k.component=l.component,k});else{v.type="integer";const l=c.case===O.UPPER;let k;switch(c.n&&c.n>0?c.optionalDigits===0?k=`{${c.n}}`:k=`{${c.n-c.optionalDigits},${c.n}}`:k="+",c.primary){case h.LETTERS:v.regex=l?"[A-Z]+":"[a-z]+",v.parse=function(D){return J(D,l?"A":"a")};break;case h.ROMAN:v.regex=l?"[MDCLXVI]+":"[mdclxvi]+",v.parse=function(D){return B(l?D:D.toUpperCase())};break;case h.WORDS:v.regex="(?:"+Object.keys(m).concat("and","[\\-, ]").join("|")+")+",v.parse=function(D){return _(D.toLowerCase())};break;case h.DECIMAL:v.regex=`[0-9]${k}`,c.ordinal&&(v.regex+="(?:th|st|nd|rd)"),v.parse=function(D){let E=D;return c.ordinal&&(E=D.substring(0,D.length-2)),c.regular?E=E.split(",").join(""):c.groupingSeparators.forEach(y=>{E=E.split(y.character).join("")}),c.zeroCode!==48&&(E=E.split("").map(y=>String.fromCodePoint(y.codePointAt(0)-c.zeroCode+48)).join("")),parseInt(E)};break;case h.SEQUENCE:throw{code:"D3130",value:c.token}}}return v}function u(c,v){if(typeof c>"u")return;const l=ue(v);return a(l).parse(c)}function F(c,v){const l=pe(v),k=a(l),D="^"+k.parts.map(L=>"("+L.regex+")").join("")+"$";var y=new RegExp(D,"i").exec(c);if(y!==null){const I={};for(let ve=1;ve<y.length;ve++){const n=k.parts[ve-1];n.parse&&(I[n.component]=n.parse(y[ve]))}if(Object.getOwnPropertyNames(I).length===0)return;let xe=0;const Ye=ve=>{xe<<=1,xe+=ve?1:0},Me=ve=>!(~ve&xe)&&!!(ve&xe);"YXMxWwdD".split("").forEach(ve=>Ye(I[ve]));const Ne=!Me(161)&&Me(130),Ze=Me(84),at=!Ze&&Me(72);xe=0,"PHhmsf".split("").forEach(ve=>Ye(I[ve]));const it=!Me(23)&&Me(47),yt=(Ne?"YD":Ze?"XxwF":at?"XWF":"YMD")+(it?"Phmsf":"Hmsf"),He=this.environment.timestamp;let ct=!1,Ve=!1;if(yt.split("").forEach(ve=>{if(typeof I[ve]>"u")ct?(I[ve]="MDd".indexOf(ve)!==-1?1:0,Ve=!0):I[ve]=V(He,ve);else if(ct=!0,Ve)throw{code:"D3136"}}),I.M>0?I.M-=1:I.M=0,Ne){const ve=Date.UTC(I.Y,0),n=(I.d-1)*1e3*60*60*24,i=new Date(ve+n);I.M=i.getUTCMonth(),I.D=i.getUTCDate()}if(Ze)throw{code:"D3136"};if(at)throw{code:"D3136"};it&&(I.H=I.h===12?0:I.h,I.P===1&&(I.H+=12));var T=Date.UTC(I.Y,I.M,I.D,I.H,I.m,I.s,I.f);return(I.Z||I.z)&&(T-=(I.Z||I.z)*60*1e3),T}}var K=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function ye(c,v){if(!(typeof c>"u"))if(typeof v>"u"){if(!K.test(c))throw{stack:new Error().stack,code:"D3110",value:c};return Date.parse(c)}else return F.call(this,c,v)}function ce(c,v,l){if(!(typeof c>"u"))return qe.call(this,c,v,l)}return{formatInteger:C,parseInteger:u,fromMillis:ce,toMillis:ye}}();P.exports=p},{"./utils":6}],2:[function(S,P,z){(function(Y){(function(){var p=S("./utils");const $=(()=>{var ne=p.isNumeric,Z=p.isArrayOfStrings,M=p.isArrayOfNumbers,b=p.createSequence,g=p.isSequence,m=p.isFunction,_=p.isLambda,q=p.isPromise,we=p.getFunctionArity,me=p.isDeepEqual,B=p.stringToArray;function w(e){if(!(typeof e>"u")){var t=0;return e.forEach(function(r){t+=r}),t}}function J(e){return typeof e>"u"?0:e.length}function C(e){if(!(typeof e>"u"||e.length===0))return Math.max.apply(Math,e)}function h(e){if(!(typeof e>"u"||e.length===0))return Math.min.apply(Math,e)}function O(e){if(!(typeof e>"u"||e.length===0)){var t=0;return e.forEach(function(r){t+=r}),t/e.length}}function U(e,t=!1){if(!(typeof e>"u")){var r;if(typeof e=="string")r=e;else if(m(e))r="";else{if(typeof e=="number"&&!isFinite(e))throw{code:"D3001",value:e,stack:new Error().stack};var f=t?2:0;Array.isArray(e)&&e.outerWrapper&&(e=e[0]),r=JSON.stringify(e,function(o,d){return typeof d<"u"&&d!==null&&d.toPrecision&&ne(d)?Number(d.toPrecision(15)):d&&m(d)?"":d},f)}return r}}function ee(e,t,r){if(!(typeof e>"u")){var f=B(e),o=f.length;if(o+t<0&&(t=0),typeof r<"u"){if(r<=0)return"";var d=t>=0?t+r:o+t+r;return f.slice(t,d).join("")}return f.slice(t).join("")}}function ue(e,t){if(!(typeof e>"u")){var r=e.indexOf(t);return r>-1?e.substr(0,r):e}}function de(e,t){if(!(typeof e>"u")){var r=e.indexOf(t);return r>-1?e.substr(r+t.length):e}}function pe(e){if(!(typeof e>"u"))return e.toLowerCase()}function ae(e){if(!(typeof e>"u"))return e.toUpperCase()}function Ae(e){if(!(typeof e>"u"))return B(e).length}function Re(e){if(!(typeof e>"u")){var t=e.replace(/[ \t\n\r]+/gm," ");return t.charAt(0)===" "&&(t=t.substring(1)),t.charAt(t.length-1)===" "&&(t=t.substring(0,t.length-1)),t}}function fe(e,t,r){if(!(typeof e>"u")){(typeof r>"u"||r.length===0)&&(r=" ");var f,o=Math.abs(t)-Ae(e);if(o>0){var d=new Array(o+1).join(r);r.length>1&&(d=ee(d,0,o)),t>0?f=e+d:f=d+e}else f=e;return f}}async function X(e,t){var r=e.apply(this,[t]);if(q(r)&&(r=await r),r&&!(typeof r.start=="number"||r.end==="number"||Array.isArray(r.groups)||m(r.next)))throw{code:"T1010",stack:new Error().stack};return r}async function ze(e,t){if(!(typeof e>"u")){var r;if(typeof t=="string")r=e.indexOf(t)!==-1;else{var f=await X(t,e);r=typeof f<"u"}return r}}async function V(e,t,r){if(!(typeof e>"u")){if(r<0)throw{stack:new Error().stack,value:r,code:"D3040",index:3};var f=b();if(typeof r>"u"||r>0){var o=0,d=await X(t,e);if(typeof d<"u")for(;typeof d<"u"&&(typeof r>"u"||o<r);)f.push({match:d.match,index:d.start,groups:d.groups}),d=await X(d.next),o++}return f}}async function Te(e,t,r,f){if(!(typeof e>"u")){var o=this;if(t==="")throw{code:"D3010",stack:new Error().stack,value:t,index:2};if(f<0)throw{code:"D3011",stack:new Error().stack,value:f,index:4};var d;typeof r=="string"?d=function(he){for(var $e="",oe=0,De=r.indexOf("$",oe);De!==-1&&oe<r.length;){$e+=r.substring(oe,De),oe=De+1;var Be=r.charAt(oe);if(Be==="$")$e+="$",oe++;else if(Be==="0")$e+=he.match,oe++;else{var Ce;if(he.groups.length===0?Ce=1:Ce=Math.floor(Math.log(he.groups.length)*Math.LOG10E)+1,De=parseInt(r.substring(oe,oe+Ce),10),Ce>1&&De>he.groups.length&&(De=parseInt(r.substring(oe,oe+Ce-1),10)),isNaN(De))$e+="$";else{if(he.groups.length>0){var lt=he.groups[De-1];typeof lt<"u"&&($e+=lt)}oe+=De.toString().length}}De=r.indexOf("$",oe)}return $e+=r.substring(oe),$e}:d=r;var A="",N=0;if(typeof f>"u"||f>0){var W=0;if(typeof t=="string"){for(var ge=e.indexOf(t,N);ge!==-1&&(typeof f>"u"||W<f);)A+=e.substring(N,ge),A+=r,N=ge+t.length,W++,ge=e.indexOf(t,N);A+=e.substring(N)}else{var te=await X(t,e);if(typeof te<"u"){for(;typeof te<"u"&&(typeof f>"u"||W<f);){A+=e.substring(N,te.start);var be=d.apply(o,[te]);if(q(be)&&(be=await be),typeof be=="string")A+=be;else throw{code:"D3012",stack:new Error().stack,value:be};N=te.start+te.match.length,W++,te=await X(te.next)}A+=e.substring(N)}else A=e}}else A=e;return A}}function qe(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.btoa:function(r){return new Y.Buffer.from(r,"binary").toString("base64")};return t(e)}}function a(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.atob:function(r){return new Y.Buffer.from(r,"base64").toString("binary")};return t(e)}}function u(e){if(!(typeof e>"u")){var t;try{t=encodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrlComponent"}}return t}}function F(e){if(!(typeof e>"u")){var t;try{t=encodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrl"}}return t}}function K(e){if(!(typeof e>"u")){var t;try{t=decodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrlComponent"}}return t}}function ye(e){if(!(typeof e>"u")){var t;try{t=decodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrl"}}return t}}async function ce(e,t,r){if(!(typeof e>"u")){if(r<0)throw{code:"D3020",stack:new Error().stack,value:r,index:3};var f=[];if(typeof r>"u"||r>0)if(typeof t=="string")f=e.split(t,r);else{var o=0,d=await X(t,e);if(typeof d<"u"){for(var A=0;typeof d<"u"&&(typeof r>"u"||o<r);)f.push(e.substring(A,d.start)),A=d.end,d=await X(d.next),o++;(typeof r>"u"||o<r)&&f.push(e.substring(A))}else f.push(e)}return f}}function c(e,t){if(!(typeof e>"u"))return typeof t>"u"&&(t=""),e.join(t)}function v(e,t,r){if(!(typeof e>"u")){var f={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"â€°","zero-digit":"0",digit:"#","pattern-separator":";"},o=f;typeof r<"u"&&Object.keys(r).forEach(function(G){o[G]=r[G]});for(var d=[],A=o["zero-digit"].charCodeAt(0),N=A;N<A+10;N++)d.push(String.fromCharCode(N));var W=d.concat([o["decimal-separator"],o["exponent-separator"],o["grouping-separator"],o.digit,o["pattern-separator"]]),ge=t.split(o["pattern-separator"]);if(ge.length>2)throw{code:"D3080",stack:new Error().stack};var te=function(G){var Ee=function(){for(var Oe,We=0;We<G.length;We++)if(Oe=G.charAt(We),W.indexOf(Oe)!==-1&&Oe!==o["exponent-separator"])return G.substring(0,We)}(),Ue=function(){for(var Oe,We=G.length-1;We>=0;We--)if(Oe=G.charAt(We),W.indexOf(Oe)!==-1&&Oe!==o["exponent-separator"])return G.substring(We+1)}(),ke=G.substring(Ee.length,G.length-Ue.length),je,ot,Ie,ft,Le=G.indexOf(o["exponent-separator"],Ee.length);Le===-1||Le>G.length-Ue.length?(je=ke,ot=void 0):(je=ke.substring(0,Le),ot=ke.substring(Le+1));var Ge=je.indexOf(o["decimal-separator"]);return Ge===-1?(Ie=je,ft=Ue):(Ie=je.substring(0,Ge),ft=je.substring(Ge+1)),{prefix:Ee,suffix:Ue,activePart:ke,mantissaPart:je,exponentPart:ot,integerPart:Ie,fractionalPart:ft,subpicture:G}},be=function(G){var Ee,Ue,ke=G.subpicture,je=ke.indexOf(o["decimal-separator"]);je!==ke.lastIndexOf(o["decimal-separator"])&&(Ee="D3081"),ke.indexOf(o.percent)!==ke.lastIndexOf(o.percent)&&(Ee="D3082"),ke.indexOf(o["per-mille"])!==ke.lastIndexOf(o["per-mille"])&&(Ee="D3083"),ke.indexOf(o.percent)!==-1&&ke.indexOf(o["per-mille"])!==-1&&(Ee="D3084");var ot=!1;for(Ue=0;Ue<G.mantissaPart.length;Ue++){var Ie=G.mantissaPart.charAt(Ue);if(d.indexOf(Ie)!==-1||Ie===o.digit){ot=!0;break}}ot||(Ee="D3085");var ft=G.activePart.split("").map(function(Oe){return W.indexOf(Oe)===-1?"p":"a"}).join("");ft.indexOf("p")!==-1&&(Ee="D3086"),je!==-1?(ke.charAt(je-1)===o["grouping-separator"]||ke.charAt(je+1)===o["grouping-separator"])&&(Ee="D3087"):G.integerPart.charAt(G.integerPart.length-1)===o["grouping-separator"]&&(Ee="D3088"),ke.indexOf(o["grouping-separator"]+o["grouping-separator"])!==-1&&(Ee="D3089");var Le=G.integerPart.indexOf(o.digit);Le!==-1&&G.integerPart.substring(0,Le).split("").filter(function(Oe){return d.indexOf(Oe)>-1}).length>0&&(Ee="D3090"),Le=G.fractionalPart.lastIndexOf(o.digit),Le!==-1&&G.fractionalPart.substring(Le).split("").filter(function(Oe){return d.indexOf(Oe)>-1}).length>0&&(Ee="D3091");var Ge=typeof G.exponentPart=="string";if(Ge&&G.exponentPart.length>0&&(ke.indexOf(o.percent)!==-1||ke.indexOf(o["per-mille"])!==-1)&&(Ee="D3092"),Ge&&(G.exponentPart.length===0||G.exponentPart.split("").filter(function(Oe){return d.indexOf(Oe)===-1}).length>0)&&(Ee="D3093"),Ee)throw{code:Ee,stack:new Error().stack}},he=function(G){var Ee=function(Fe,Pt){for(var wt=[],Qe=Fe.indexOf(o["grouping-separator"]);Qe!==-1;){var St=(Pt?Fe.substring(0,Qe):Fe.substring(Qe)).split("").filter(function(pt){return d.indexOf(pt)!==-1||pt===o.digit}).length;wt.push(St),Qe=G.integerPart.indexOf(o["grouping-separator"],Qe+1)}return wt},Ue=Ee(G.integerPart),ke=function(Fe){if(Fe.length===0)return 0;for(var Pt=function(St,pt){return pt===0?St:Pt(pt,St%pt)},wt=Fe.reduce(Pt),Qe=1;Qe<=Fe.length;Qe++)if(Fe.indexOf(Qe*wt)===-1)return 0;return wt},je=ke(Ue),ot=Ee(G.fractionalPart,!0),Ie=G.integerPart.split("").filter(function(Fe){return d.indexOf(Fe)!==-1}).length,ft=Ie,Le=G.fractionalPart.split(""),Ge=Le.filter(function(Fe){return d.indexOf(Fe)!==-1}).length,Oe=Le.filter(function(Fe){return d.indexOf(Fe)!==-1||Fe===o.digit}).length,We=typeof G.exponentPart=="string";Ie===0&&Oe===0&&(We?(Ge=1,Oe=1):Ie=1),We&&Ie===0&&G.integerPart.indexOf(o.digit)!==-1&&(Ie=1),Ie===0&&Ge===0&&(Ge=1);var Ut=0;return We&&(Ut=G.exponentPart.split("").filter(function(Fe){return d.indexOf(Fe)!==-1}).length),{integerPartGroupingPositions:Ue,regularGrouping:je,minimumIntegerPartSize:Ie,scalingFactor:ft,prefix:G.prefix,fractionalPartGroupingPositions:ot,minimumFactionalPartSize:Ge,maximumFactionalPartSize:Oe,minimumExponentSize:Ut,suffix:G.suffix,picture:G.subpicture}},$e=ge.map(te);$e.forEach(be);var oe=$e.map(he),De=o["minus-sign"],Be=o["zero-digit"],Ce=o["decimal-separator"],lt=o["grouping-separator"];oe.length===1&&(oe.push(JSON.parse(JSON.stringify(oe[0]))),oe[1].prefix=De+oe[1].prefix);var Pe;e>=0?Pe=oe[0]:Pe=oe[1];var mt;Pe.picture.indexOf(o.percent)!==-1?mt=e*100:Pe.picture.indexOf(o["per-mille"])!==-1?mt=e*1e3:mt=e;var ut,dt;if(Pe.minimumExponentSize===0)ut=mt;else{var Yt=Math.pow(10,Pe.scalingFactor),Bt=Math.pow(10,Pe.scalingFactor-1);for(ut=mt,dt=0;ut<Bt;)ut*=10,dt-=1;for(;ut>Yt;)ut/=10,dt+=1}var Ht=T(ut,Pe.maximumFactionalPartSize),Nt=function(G,Ee){var Ue=Math.abs(G).toFixed(Ee);return Be!=="0"&&(Ue=Ue.split("").map(function(ke){return ke>="0"&&ke<="9"?d[ke.charCodeAt(0)-48]:ke}).join("")),Ue},Q=Nt(Ht,Pe.maximumFactionalPartSize),_e=Q.indexOf(".");for(_e===-1?Q=Q+Ce:Q=Q.replace(".",Ce);Q.charAt(0)===Be;)Q=Q.substring(1);for(;Q.charAt(Q.length-1)===Be;)Q=Q.substring(0,Q.length-1);_e=Q.indexOf(Ce);var bt=Pe.minimumIntegerPartSize-_e,_t=Pe.minimumFactionalPartSize-(Q.length-_e-1);if(Q=(bt>0?new Array(bt+1).join(Be):"")+Q,Q=Q+(_t>0?new Array(_t+1).join(Be):""),_e=Q.indexOf(Ce),Pe.regularGrouping>0)for(var Gt=Math.floor((_e-1)/Pe.regularGrouping),Dt=1;Dt<=Gt;Dt++)Q=[Q.slice(0,_e-Dt*Pe.regularGrouping),lt,Q.slice(_e-Dt*Pe.regularGrouping)].join("");else Pe.integerPartGroupingPositions.forEach(function(G){Q=[Q.slice(0,_e-G),lt,Q.slice(_e-G)].join(""),_e++});if(_e=Q.indexOf(Ce),Pe.fractionalPartGroupingPositions.forEach(function(G){Q=[Q.slice(0,G+_e+1),lt,Q.slice(G+_e+1)].join("")}),_e=Q.indexOf(Ce),(Pe.picture.indexOf(Ce)===-1||_e===Q.length-1)&&(Q=Q.substring(0,Q.length-1)),typeof dt<"u"){var Tt=Nt(dt,0);bt=Pe.minimumExponentSize-Tt.length,bt>0&&(Tt=new Array(bt+1).join(Be)+Tt),Q=Q+o["exponent-separator"]+(dt<0?De:"")+Tt}return Q=Pe.prefix+Q+Pe.suffix,Q}}function l(e,t){if(!(typeof e>"u")){if(e=T(e),typeof t>"u"?t=10:t=T(t),t<2||t>36)throw{code:"D3100",stack:new Error().stack,value:t};var r=e.toString(t);return r}}function k(e){var t;if(!(typeof e>"u")){if(typeof e=="number")t=e;else if(typeof e=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(e)&&!isNaN(parseFloat(e))&&isFinite(e))t=parseFloat(e);else if(typeof e=="string"&&/^(0[xX][0-9A-Fa-f]+)|(0[oO][0-7]+)|(0[bB][0-1]+)$/.test(e))t=Number(e);else if(e===!0)t=1;else if(e===!1)t=0;else throw{code:"D3030",value:e,stack:new Error().stack,index:1};return t}}function D(e){var t;if(!(typeof e>"u"))return t=Math.abs(e),t}function E(e){var t;if(!(typeof e>"u"))return t=Math.floor(e),t}function y(e){var t;if(!(typeof e>"u"))return t=Math.ceil(e),t}function T(e,t){var r;if(!(typeof e>"u")){if(t){var f=e.toString().split("e");e=+(f[0]+"e"+(f[1]?+f[1]+t:t))}r=Math.round(e);var o=r-e;return Math.abs(o)===.5&&Math.abs(r%2)===1&&(r=r-1),t&&(f=r.toString().split("e"),r=+(f[0]+"e"+(f[1]?+f[1]-t:-t))),Object.is(r,-0)&&(r=0),r}}function L(e){var t;if(!(typeof e>"u")){if(e<0)throw{stack:new Error().stack,code:"D3060",index:1,value:e};return t=Math.sqrt(e),t}}function re(e,t){var r;if(!(typeof e>"u")){if(r=Math.pow(e,t),!isFinite(r))throw{stack:new Error().stack,code:"D3061",index:1,value:e,exp:t};return r}}function ie(){return Math.random()}function R(e){if(!(typeof e>"u")){var t=!1;if(Array.isArray(e)){if(e.length===1)t=R(e[0]);else if(e.length>1){var r=e.filter(function(f){return R(f)});t=r.length>0}}else typeof e=="string"?e.length>0&&(t=!0):ne(e)?e!==0&&(t=!0):e!==null&&typeof e=="object"?Object.keys(e).length>0&&(t=!0):typeof e=="boolean"&&e===!0&&(t=!0);return t}}function H(e){if(!(typeof e>"u"))return!R(e)}function le(e,t,r,f){var o=[t],d=we(e);return d>=2&&o.push(r),d>=3&&o.push(f),o}async function I(e,t){if(!(typeof e>"u")){for(var r=b(),f=0;f<e.length;f++){var o=le(t,e[f],f,e),d=await t.apply(this,o);typeof d<"u"&&r.push(d)}return r}}async function xe(e,t){if(!(typeof e>"u")){for(var r=b(),f=0;f<e.length;f++){var o=e[f],d=le(t,o,f,e),A=await t.apply(this,d);R(A)&&r.push(o)}return r}}async function Ye(e,t){if(!(typeof e>"u")){for(var r=!1,f,o=0;o<e.length;o++){var d=e[o],A=!0;if(typeof t<"u"){var N=le(t,d,o,e),W=await t.apply(this,N);A=R(W)}if(A)if(!r)f=d,r=!0;else throw{stack:new Error().stack,code:"D3138",index:o}}if(!r)throw{stack:new Error().stack,code:"D3139"};return f}}function Me(){for(var e=[],t=Array.prototype.slice.call(arguments),r=Math.min.apply(Math,t.map(function(d){return Array.isArray(d)?d.length:0})),f=0;f<r;f++){var o=t.map(d=>d[f]);e.push(o)}return e}async function Se(e,t,r){if(!(typeof e>"u")){var f,o=we(t);if(o<2)throw{stack:new Error().stack,code:"D3050",index:1};var d;for(typeof r>"u"&&e.length>0?(f=e[0],d=1):(f=r,d=0);d<e.length;){var A=[f,e[d]];o>=3&&A.push(d),o>=4&&A.push(e),f=await t.apply(this,A),d++}return f}}function Ne(e){var t=b();if(Array.isArray(e)){var r={};e.forEach(function(f){var o=Ne(f);o.forEach(function(d){r[d]=!0})}),t=Ne(r)}else e!==null&&typeof e=="object"&&!m(e)&&Object.keys(e).forEach(f=>t.push(f));return t}function Ze(e,t){var r;if(Array.isArray(e)){r=b();for(var f=0;f<e.length;f++){var o=Ze(e[f],t);typeof o<"u"&&(Array.isArray(o)?o.forEach(d=>r.push(d)):r.push(o))}}else e!==null&&typeof e=="object"&&!m(e)&&(r=e[t]);return r}function at(e,t){return typeof e>"u"?t:typeof t>"u"?e:(Array.isArray(e)||(e=b(e)),Array.isArray(t)||(t=[t]),e.concat(t))}function At(e){return!(typeof e>"u")}function it(e){var t=b();if(Array.isArray(e))e.forEach(function(o){t=at(t,it(o))});else if(e!==null&&typeof e=="object"&&!_(e))for(var r in e){var f={};f[r]=e[r],t.push(f)}else t=e;return t}function x(e){if(!(typeof e>"u")){var t={};return e.forEach(function(r){for(var f in r)t[f]=r[f]}),t}}function Et(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=e.length,r=new Array(t),f=0;f<t;f++)r[t-f-1]=e[f];return r}}async function yt(e,t){var r=b();for(var f in e){var o=le(t,e[f],f,e),d=await t.apply(this,o);typeof d<"u"&&r.push(d)}return r}function He(e){throw{code:"D3137",stack:new Error().stack,message:e||"$error() function evaluated"}}function ct(e,t){if(!e)throw{code:"D3141",stack:new Error().stack,message:t||"$assert() statement failed"}}function Ve(e){if(e!==void 0)return e===null?"null":ne(e)?"number":typeof e=="string"?"string":typeof e=="boolean"?"boolean":Array.isArray(e)?"array":m(e)?"function":"object"}async function ve(e,t){if(!(typeof e>"u")){if(e.length<=1)return e;var r;if(typeof t>"u"){if(!M(e)&&!Z(e))throw{stack:new Error().stack,code:"D3070",index:1};r=async function(A,N){return A>N}}else r=t;var f=async function(A,N){var W=async function(te,be,he){be.length===0?Array.prototype.push.apply(te,he):he.length===0?Array.prototype.push.apply(te,be):await r(be[0],he[0])?(te.push(he[0]),await W(te,be,he.slice(1))):(te.push(be[0]),await W(te,be.slice(1),he))},ge=[];return await W(ge,A,N),ge},o=async function(A){if(!Array.isArray(A)||A.length<=1)return A;var N=Math.floor(A.length/2),W=A.slice(0,N),ge=A.slice(N);return W=await o(W),ge=await o(ge),await f(W,ge)},d=await o(e);return d}}function n(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=new Array(e.length),r=0;r<e.length;r++){var f=Math.floor(Math.random()*(r+1));r!==f&&(t[r]=t[f]),t[f]=e[r]}return t}}function i(e){if(!(typeof e>"u")){if(!Array.isArray(e)||e.length<=1)return e;for(var t=g(e)?b():[],r=0;r<e.length;r++){for(var f=e[r],o=!1,d=0;d<t.length;d++)if(me(f,t[d])){o=!0;break}o||t.push(f)}return t}}async function s(e,t){var r={};for(var f in e){var o=e[f],d=le(t,o,f,e),A=await t.apply(this,d);R(A)&&(r[f]=o)}return Object.keys(r).length===0&&(r=void 0),r}return{sum:w,count:J,max:C,min:h,average:O,string:U,substring:ee,substringBefore:ue,substringAfter:de,lowercase:pe,uppercase:ae,length:Ae,trim:Re,pad:fe,match:V,contains:ze,replace:Te,split:ce,join:c,formatNumber:v,formatBase:l,number:k,floor:E,ceil:y,round:T,abs:D,sqrt:L,power:re,random:ie,boolean:R,not:H,map:I,zip:Me,filter:xe,single:Ye,foldLeft:Se,sift:s,keys:Ne,lookup:Ze,append:at,exists:At,spread:it,merge:x,reverse:Et,each:yt,error:He,assert:ct,type:Ve,sort:ve,shuffle:n,distinct:i,base64encode:qe,base64decode:a,encodeUrlComponent:u,encodeUrl:F,decodeUrlComponent:K,decodeUrl:ye}})();P.exports=$}).call(this)}).call(this,typeof jt<"u"?jt:typeof self<"u"?self:typeof window<"u"?window:{})},{"./utils":6}],3:[function(S,P,z){var Y=S("./datetime"),p=S("./functions"),$=S("./utils"),ne=S("./parser"),Z=S("./signature"),M=function(){var b=$.isNumeric,g=$.isArrayOfStrings,m=$.isArrayOfNumbers,_=$.createSequence,q=$.isSequence,we=$.isFunction,me=$.isLambda,B=$.isIterable,w=$.isPromise,J=$.getFunctionArity,C=$.isDeepEqual,h=He(null);async function O(n,i,s){var e,t=s.lookup("__evaluate_entry");switch(t&&await t(n,i,s),n.type){case"path":e=await U(n,i,s);break;case"binary":e=await Ae(n,i,s);break;case"unary":e=await Re(n,i,s);break;case"name":e=fe(n,i);break;case"string":case"number":case"value":e=X(n);break;case"wildcard":e=ze(n,i);break;case"descendant":e=Te(n,i);break;case"parent":e=s.lookup(n.slot.label);break;case"condition":e=await E(n,i,s);break;case"block":e=await y(n,i,s);break;case"bind":e=await D(n,i,s);break;case"regex":e=T(n);break;case"function":e=await le(n,i,s);break;case"variable":e=L(n,i,s);break;case"lambda":e=Ye(n,i,s);break;case"partial":e=await Me(n,i,s);break;case"apply":e=await H(n,i,s);break;case"transform":e=ie(n,i,s);break}if(Object.prototype.hasOwnProperty.call(n,"predicate"))for(var r=0;r<n.predicate.length;r++)e=await ae(n.predicate[r].expr,e,s);n.type!=="path"&&Object.prototype.hasOwnProperty.call(n,"group")&&(e=await v(n.group,e,s));var f=s.lookup("__evaluate_exit");return f&&await f(n,i,s,e),e&&q(e)&&!e.tupleStream&&(n.keepArray&&(e.keepSingleton=!0),e.length===0?e=void 0:e.length===1&&(e=e.keepSingleton?e:e[0])),e}async function U(n,i,s){var e;Array.isArray(i)&&n.steps[0].type!=="variable"?e=i:e=_(i);for(var t,r=!1,f=void 0,o=0;o<n.steps.length;o++){var d=n.steps[o];if(d.tuple&&(r=!0),o===0&&d.consarray?t=await O(d,e,s):r?f=await pe(d,e,f,s):t=await ue(d,e,s,o===n.steps.length-1),!r&&(typeof t>"u"||t.length===0))break;typeof d.focus>"u"&&(e=t)}if(r)if(n.tuple)t=f;else for(t=_(),o=0;o<f.length;o++)t.push(f[o]["@"]);return n.keepSingletonArray&&(Array.isArray(t)&&t.cons&&!t.sequence&&(t=_(t)),t.keepSingleton=!0),n.hasOwnProperty("group")&&(t=await v(n.group,r?f:t,s)),t}function ee(n,i){var s=He(n);for(const e in i)s.bind(e,i[e]);return s}async function ue(n,i,s,e){var t;if(n.type==="sort")return t=await re(n,i,s),n.stages&&(t=await de(n.stages,t,s)),t;t=_();for(var r=0;r<i.length;r++){var f=await O(n,i[r],s);if(n.stages)for(var o=0;o<n.stages.length;o++)f=await ae(n.stages[o].expr,f,s);typeof f<"u"&&t.push(f)}var d=_();return e&&t.length===1&&Array.isArray(t[0])&&!q(t[0])?d=t[0]:t.forEach(function(A){!Array.isArray(A)||A.cons?d.push(A):A.forEach(N=>d.push(N))}),d}async function de(n,i,s){for(var e=i,t=0;t<n.length;t++){var r=n[t];switch(r.type){case"filter":e=await ae(r.expr,e,s);break;case"index":for(var f=0;f<e.length;f++){var o=e[f];o[r.value]=f}break}}return e}async function pe(n,i,s,e){var t;if(n.type==="sort"){if(s)t=await re(n,s,e);else{var r=await re(n,i,e);t=_(),t.tupleStream=!0;for(var f=0;f<r.length;f++){var o={"@":r[f]};o[n.index]=f,t.push(o)}}return n.stages&&(t=await de(n.stages,t,e)),t}t=_(),t.tupleStream=!0;var d=e;s===void 0&&(s=i.map(ge=>({"@":ge})));for(var A=0;A<s.length;A++){d=ee(e,s[A]);var N=await O(n,s[A]["@"],d);if(typeof N<"u"){Array.isArray(N)||(N=[N]);for(var W=0;W<N.length;W++)o={},Object.assign(o,s[A]),N.tupleStream?Object.assign(o,N[W]):(n.focus?(o[n.focus]=N[W],o["@"]=s[A]["@"]):o["@"]=N[W],n.index&&(o[n.index]=W),n.ancestor&&(o[n.ancestor.label]=s[A]["@"])),t.push(o)}}return n.stages&&(t=await de(n.stages,t,e)),t}async function ae(n,i,s){var e=_();if(i&&i.tupleStream&&(e.tupleStream=!0),Array.isArray(i)||(i=_(i)),n.type==="number"){var t=Math.floor(n.value);t<0&&(t=i.length+t);var r=i[t];typeof r<"u"&&(Array.isArray(r)?e=r:e.push(r))}else for(t=0;t<i.length;t++){var r=i[t],f=r,o=s;i.tupleStream&&(f=r["@"],o=ee(s,r));var d=await O(n,f,o);b(d)&&(d=[d]),m(d)?d.forEach(function(N){var W=Math.floor(N);W<0&&(W=i.length+W),W===t&&e.push(r)}):p.boolean(d)&&e.push(r)}return e}async function Ae(n,i,s){var e,t=await O(n.lhs,i,s),r=n.value,f=async()=>await O(n.rhs,i,s);if(r==="and"||r==="or")try{return await ye(t,f,r)}catch(d){throw d.position=n.position,d.token=r,d}var o=await f();try{switch(r){case"+":case"-":case"*":case"/":case"%":e=a(t,o,r);break;case"=":case"!=":e=u(t,o,r);break;case"<":case"<=":case">":case">=":e=F(t,o,r);break;case"&":e=c(t,o);break;case"..":e=k(t,o);break;case"in":e=K(t,o);break}}catch(d){throw d.position=n.position,d.token=r,d}return e}async function Re(n,i,s){var e;switch(n.value){case"-":if(e=await O(n.expression,i,s),typeof e>"u")e=void 0;else if(b(e))e=-e;else throw{code:"D1002",stack:new Error().stack,position:n.position,token:n.value,value:e};break;case"[":e=[];let f=await Promise.all(n.expressions.map(async(o,d)=>(s.isParallelCall=d>0,[o,await O(o,i,s)])));for(let o of f){var[t,r]=o;typeof r<"u"&&(t.value==="["?e.push(r):e=p.append(e,r))}n.consarray&&Object.defineProperty(e,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":e=await v(n,i,s);break}return e}function fe(n,i,s){return p.lookup(i,n.value)}function X(n){return n.value}function ze(n,i){var s=_();return Array.isArray(i)&&i.outerWrapper&&i.length>0&&(i=i[0]),i!==null&&typeof i=="object"&&Object.keys(i).forEach(function(e){var t=i[e];Array.isArray(t)?(t=V(t),s=p.append(s,t)):s.push(t)}),s}function V(n,i){return typeof i>"u"&&(i=[]),Array.isArray(n)?n.forEach(function(s){V(s,i)}):i.push(n),i}function Te(n,i){var s,e=_();return typeof i<"u"&&(qe(i,e),e.length===1?s=e[0]:s=e),s}function qe(n,i){Array.isArray(n)||i.push(n),Array.isArray(n)?n.forEach(function(s){qe(s,i)}):n!==null&&typeof n=="object"&&Object.keys(n).forEach(function(s){qe(n[s],i)})}function a(n,i,s){var e;if(typeof n<"u"&&!b(n))throw{code:"T2001",stack:new Error().stack,value:n};if(typeof i<"u"&&!b(i))throw{code:"T2002",stack:new Error().stack,value:i};if(typeof n>"u"||typeof i>"u")return e;switch(s){case"+":e=n+i;break;case"-":e=n-i;break;case"*":e=n*i;break;case"/":e=n/i;break;case"%":e=n%i;break}return e}function u(n,i,s){var e,t=typeof n,r=typeof i;if(t==="undefined"||r==="undefined")return!1;switch(s){case"=":e=C(n,i);break;case"!=":e=!C(n,i);break}return e}function F(n,i,s){var e,t=typeof n,r=typeof i,f=t==="undefined"||t==="string"||t==="number",o=r==="undefined"||r==="string"||r==="number";if(!f||!o)throw{code:"T2010",stack:new Error().stack,value:t==="string"||t==="number"?i:n};if(!(t==="undefined"||r==="undefined")){if(t!==r)throw{code:"T2009",stack:new Error().stack,value:n,value2:i};switch(s){case"<":e=n<i;break;case"<=":e=n<=i;break;case">":e=n>i;break;case">=":e=n>=i;break}return e}}function K(n,i){var s=!1;if(typeof n>"u"||typeof i>"u")return!1;Array.isArray(i)||(i=[i]);for(var e=0;e<i.length;e++)if(i[e]===n){s=!0;break}return s}async function ye(n,i,s){var e,t=ce(n);switch(s){case"and":e=t&&ce(await i());break;case"or":e=t||ce(await i());break}return e}function ce(n){var i=p.boolean(n);return typeof i>"u"?!1:i}function c(n,i){var s,e="",t="";return typeof n<"u"&&(e=p.string(n)),typeof i<"u"&&(t=p.string(i)),s=e.concat(t),s}async function v(n,i,s){var e={},t={},r=!!(i&&i.tupleStream);Array.isArray(i)||(i=_(i)),i.length===0&&i.push(void 0);for(var f=0;f<i.length;f++)for(var o=i[f],d=r?ee(s,o):s,A=0;A<n.lhs.length;A++){var N=n.lhs[A],W=await O(N[0],r?o["@"]:o,d);if(typeof W!="string"&&W!==void 0)throw{code:"T1003",stack:new Error().stack,position:n.position,value:W};if(W!==void 0){var ge={data:o,exprIndex:A};if(t.hasOwnProperty(W)){if(t[W].exprIndex!==A)throw{code:"D1009",stack:new Error().stack,position:n.position,value:W};t[W].data=p.append(t[W].data,o)}else t[W]=ge}}let te=await Promise.all(Object.keys(t).map(async(he,$e)=>{let oe=t[he];var De=oe.data,Be=s;if(r){var Ce=l(oe.data);De=Ce["@"],delete Ce["@"],Be=ee(s,Ce)}return s.isParallelCall=$e>0,[he,await O(n.lhs[oe.exprIndex][1],De,Be)]}));for(let he of te){var[W,be]=await he;typeof be<"u"&&(e[W]=be)}return e}function l(n){if(!Array.isArray(n))return n;var i={};Object.assign(i,n[0]);for(var s=1;s<n.length;s++)for(const e in n[s])i[e]=p.append(i[e],n[s][e]);return i}function k(n,i){var s;if(typeof n<"u"&&!Number.isInteger(n))throw{code:"T2003",stack:new Error().stack,value:n};if(typeof i<"u"&&!Number.isInteger(i))throw{code:"T2004",stack:new Error().stack,value:i};if(typeof n>"u"||typeof i>"u"||n>i)return s;var e=i-n+1;if(e>1e7)throw{code:"D2014",stack:new Error().stack,value:e};s=new Array(e);for(var t=n,r=0;t<=i;t++,r++)s[r]=t;return s.sequence=!0,s}async function D(n,i,s){var e=await O(n.rhs,i,s);return s.bind(n.lhs.value,e),e}async function E(n,i,s){var e,t=await O(n.condition,i,s);return p.boolean(t)?e=await O(n.then,i,s):typeof n.else<"u"&&(e=await O(n.else,i,s)),e}async function y(n,i,s){for(var e,t=He(s),r=0;r<n.expressions.length;r++)e=await O(n.expressions[r],i,t);return e}function T(n){var i=new ve.RegexEngine(n.value),s=function(e,t){var r;i.lastIndex=t||0;var f=i.exec(e);if(f!==null){if(r={match:f[0],start:f.index,end:f.index+f[0].length,groups:[]},f.length>1)for(var o=1;o<f.length;o++)r.groups.push(f[o]);r.next=function(){if(!(i.lastIndex>=e.length)){var d=s(e,i.lastIndex);if(d&&d.match==="")throw{code:"D1004",stack:new Error().stack,position:n.position,value:n.value.source};return d}}}return r};return s}function L(n,i,s){var e;return n.value===""?e=i&&i.outerWrapper?i[0]:i:e=s.lookup(n.value),e}async function re(n,i,s){var e,t=i,r=!!i.tupleStream,f=async function(d,A){for(var N=0,W=0;N===0&&W<n.terms.length;W++){var ge=n.terms[W],te=d,be=s;r&&(te=d["@"],be=ee(s,d));var he=await O(ge.expression,te,be);te=A,be=s,r&&(te=A["@"],be=ee(s,A));var $e=await O(ge.expression,te,be),oe=typeof he,De=typeof $e;if(oe==="undefined"){N=De==="undefined"?0:1;continue}if(De==="undefined"){N=-1;continue}if(!(oe==="string"||oe==="number")||!(De==="string"||De==="number"))throw{code:"T2008",stack:new Error().stack,position:n.position,value:oe==="string"||oe==="number"?$e:he};if(oe!==De)throw{code:"T2007",stack:new Error().stack,position:n.position,value:he,value2:$e};he!==$e&&(he<$e?N=-1:N=1,ge.descending===!0&&(N=-N))}return N===1},o={environment:s,input:i};return e=await p.sort.apply(o,[t,f]),e}function ie(n,i,s){var e=async function(t){if(!(typeof t>"u")){var r=s.lookup("clone");if(!we(r))throw{code:"T2013",stack:new Error().stack,position:n.position};var f=await I(r,[t],null,s),o=await O(n.pattern,f,s);if(typeof o<"u"){Array.isArray(o)||(o=[o]);for(var d=0;d<o.length;d++){var A=o[d];if(A&&(A.isPrototypeOf(f)||A instanceof Object.constructor))throw{code:"D1010",stack:new Error().stack,position:n.position};var N=await O(n.update,A,s),W=typeof N;if(W!=="undefined"){if(W!=="object"||N===null||Array.isArray(N))throw{code:"T2011",stack:new Error().stack,position:n.update.position,value:N};for(var ge in N)A[ge]=N[ge]}if(typeof n.delete<"u"){var te=await O(n.delete,A,s);if(typeof te<"u"){var be=te;if(Array.isArray(te)||(te=[te]),!g(te))throw{code:"T2012",stack:new Error().stack,position:n.delete.position,value:be};for(var he=0;he<te.length;he++)typeof A=="object"&&A!==null&&delete A[te[he]]}}}}return f}};return x(e,"<(oa):o>")}var R=ne("function($f, $g) { function($x){ $g($f($x)) } }");async function H(n,i,s){var e,t=await O(n.lhs,i,s);if(n.rhs.type==="function")e=await le(n.rhs,i,s,{context:t});else{var r=await O(n.rhs,i,s);if(!we(r))throw{code:"T2006",stack:new Error().stack,position:n.position,value:r};if(we(t)){var f=await O(R,null,s);e=await I(f,[t,r],null,s)}else e=await I(r,[t],null,s)}return e}async function le(n,i,s,e){var t,r=await O(n.procedure,i,s);if(typeof r>"u"&&n.procedure.type==="path"&&s.lookup(n.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:n.position,token:n.procedure.steps[0].value};var f=[];typeof e<"u"&&f.push(e.context);for(var o=0;o<n.arguments.length;o++){const A=await O(n.arguments[o],i,s);if(we(A)){const N=async function(...W){return await I(A,W,null,s)};N.arity=J(A),f.push(N)}else f.push(A)}var d=n.procedure.type==="path"?n.procedure.steps[0].value:n.procedure.value;try{typeof r=="object"&&(r.token=d,r.position=n.position),t=await I(r,f,i,s)}catch(A){throw A.position||(A.position=n.position),A.token||(A.token=d),A}return t}async function I(n,i,s,e){var t;for(t=await xe(n,i,s,e);me(t)&&t.thunk===!0;){var r=await O(t.body.procedure,t.input,t.environment);t.body.procedure.type==="variable"&&(r.token=t.body.procedure.value),r.position=t.body.procedure.position;for(var f=[],o=0;o<t.body.arguments.length;o++)f.push(await O(t.body.arguments[o],t.input,t.environment));t=await xe(r,f,s,e)}return t}async function xe(n,i,s,e){var t;try{var r=i;if(n&&(r=Se(n.signature,i,s)),me(n))t=await Ne(n,r);else if(n&&n._jsonata_function===!0){var f={environment:e,input:s};t=n.implementation.apply(f,r),B(t)&&(t=t.next().value),w(t)&&(t=await t)}else if(typeof n=="function")t=n.apply(s,r),w(t)&&(t=await t);else throw{code:"T1006",stack:new Error().stack}}catch(o){throw n&&(typeof o.token>"u"&&typeof n.token<"u"&&(o.token=n.token),o.position=n.position||o.position),o}return t}function Ye(n,i,s){var e={_jsonata_lambda:!0,input:i,environment:s,arguments:n.arguments,signature:n.signature,body:n.body};return n.thunk===!0&&(e.thunk=!0),e.apply=async function(t,r){return await I(e,r,i,t?t.environment:s)},e}async function Me(n,i,s){for(var e,t=[],r=0;r<n.arguments.length;r++){var f=n.arguments[r];f.type==="operator"&&f.value==="?"?t.push(f):t.push(await O(f,i,s))}var o=await O(n.procedure,i,s);if(typeof o>"u"&&n.procedure.type==="path"&&s.lookup(n.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:n.position,token:n.procedure.steps[0].value};if(me(o))e=Ze(o,t);else if(o&&o._jsonata_function===!0)e=at(o.implementation,t);else if(typeof o=="function")e=at(o,t);else throw{code:"T1008",stack:new Error().stack,position:n.position,token:n.procedure.type==="path"?n.procedure.steps[0].value:n.procedure.value};return e}function Se(n,i,s){if(typeof n>"u")return i;var e=n.validate(i,s);return e}async function Ne(n,i){var s,e=He(n.environment);return n.arguments.forEach(function(t,r){e.bind(t.value,i[r])}),typeof n.body=="function"?s=await At(n.body,e):s=await O(n.body,n.input,e),s}function Ze(n,i){var s=He(n.environment),e=[];n.arguments.forEach(function(r,f){var o=i[f];o&&o.type==="operator"&&o.value==="?"?e.push(r):s.bind(r.value,o)});var t={_jsonata_lambda:!0,input:n.input,environment:s,arguments:e,body:n.body};return t}function at(n,i){var s=it(n);s=s.map(function(f){return"$"+f.trim()});var e="function("+s.join(", ")+"){ _ }",t=ne(e);t.body=n;var r=Ze(t,i);return r}async function At(n,i){var s=it(n),e=s.map(function(f){return i.lookup(f.trim())}),t={environment:i},r=n.apply(t,e);return w(r)&&(r=await r),r}function it(n){var i=n.toString(),s=/\(([^)]*)\)/.exec(i)[1],e=s.split(",");return e}function x(n,i){var s={_jsonata_function:!0,implementation:n};return typeof i<"u"&&(s.signature=Z(i)),s}async function Et(n,i){if(!(typeof n>"u")){var s=this.input;typeof i<"u"&&(s=i,Array.isArray(s)&&!q(s)&&(s=_(s),s.outerWrapper=!0));try{var e=ne(n,!1)}catch(r){throw Ve(r),{stack:new Error().stack,code:"D3120",value:r.message,error:r}}try{var t=await O(e,s,this.environment)}catch(r){throw Ve(r),{stack:new Error().stack,code:"D3121",value:r.message,error:r}}return t}}function yt(n){if(!(typeof n>"u"))return JSON.parse(p.string(n))}function He(n){var i={};return{bind:function(s,e){i[s]=e},lookup:function(s){var e;return i.hasOwnProperty(s)?e=i[s]:n&&(e=n.lookup(s)),e},timestamp:n?n.timestamp:null,async:n?n.async:!1,isParallelCall:n?n.isParallelCall:!1,global:n?n.global:{ancestry:[null]}}}h.bind("sum",x(p.sum,"<a<n>:n>")),h.bind("count",x(p.count,"<a:n>")),h.bind("max",x(p.max,"<a<n>:n>")),h.bind("min",x(p.min,"<a<n>:n>")),h.bind("average",x(p.average,"<a<n>:n>")),h.bind("string",x(p.string,"<x-b?:s>")),h.bind("substring",x(p.substring,"<s-nn?:s>")),h.bind("substringBefore",x(p.substringBefore,"<s-s:s>")),h.bind("substringAfter",x(p.substringAfter,"<s-s:s>")),h.bind("lowercase",x(p.lowercase,"<s-:s>")),h.bind("uppercase",x(p.uppercase,"<s-:s>")),h.bind("length",x(p.length,"<s-:n>")),h.bind("trim",x(p.trim,"<s-:s>")),h.bind("pad",x(p.pad,"<s-ns?:s>")),h.bind("match",x(p.match,"<s-f<s:o>n?:a<o>>")),h.bind("contains",x(p.contains,"<s-(sf):b>")),h.bind("replace",x(p.replace,"<s-(sf)(sf)n?:s>")),h.bind("split",x(p.split,"<s-(sf)n?:a<s>>")),h.bind("join",x(p.join,"<a<s>s?:s>")),h.bind("formatNumber",x(p.formatNumber,"<n-so?:s>")),h.bind("formatBase",x(p.formatBase,"<n-n?:s>")),h.bind("formatInteger",x(Y.formatInteger,"<n-s:s>")),h.bind("parseInteger",x(Y.parseInteger,"<s-s:n>")),h.bind("number",x(p.number,"<(nsb)-:n>")),h.bind("floor",x(p.floor,"<n-:n>")),h.bind("ceil",x(p.ceil,"<n-:n>")),h.bind("round",x(p.round,"<n-n?:n>")),h.bind("abs",x(p.abs,"<n-:n>")),h.bind("sqrt",x(p.sqrt,"<n-:n>")),h.bind("power",x(p.power,"<n-n:n>")),h.bind("random",x(p.random,"<:n>")),h.bind("boolean",x(p.boolean,"<x-:b>")),h.bind("not",x(p.not,"<x-:b>")),h.bind("map",x(p.map,"<af>")),h.bind("zip",x(p.zip,"<a+>")),h.bind("filter",x(p.filter,"<af>")),h.bind("single",x(p.single,"<af?>")),h.bind("reduce",x(p.foldLeft,"<afj?:j>")),h.bind("sift",x(p.sift,"<o-f?:o>")),h.bind("keys",x(p.keys,"<x-:a<s>>")),h.bind("lookup",x(p.lookup,"<x-s:x>")),h.bind("append",x(p.append,"<xx:a>")),h.bind("exists",x(p.exists,"<x:b>")),h.bind("spread",x(p.spread,"<x-:a<o>>")),h.bind("merge",x(p.merge,"<a<o>:o>")),h.bind("reverse",x(p.reverse,"<a:a>")),h.bind("each",x(p.each,"<o-f:a>")),h.bind("error",x(p.error,"<s?:x>")),h.bind("assert",x(p.assert,"<bs?:x>")),h.bind("type",x(p.type,"<x:s>")),h.bind("sort",x(p.sort,"<af?:a>")),h.bind("shuffle",x(p.shuffle,"<a:a>")),h.bind("distinct",x(p.distinct,"<x:x>")),h.bind("base64encode",x(p.base64encode,"<s-:s>")),h.bind("base64decode",x(p.base64decode,"<s-:s>")),h.bind("encodeUrlComponent",x(p.encodeUrlComponent,"<s-:s>")),h.bind("encodeUrl",x(p.encodeUrl,"<s-:s>")),h.bind("decodeUrlComponent",x(p.decodeUrlComponent,"<s-:s>")),h.bind("decodeUrl",x(p.decodeUrl,"<s-:s>")),h.bind("eval",x(Et,"<sx?:x>")),h.bind("toMillis",x(Y.toMillis,"<s-s?:n>")),h.bind("fromMillis",x(Y.fromMillis,"<n-s?s?:s>")),h.bind("clone",x(yt,"<(oa)-:o>"));var ct={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",D1010:"Attempted to access the Javascript object prototype",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function Ve(n){var i=ct[n.code];if(typeof i<"u"){var s=i.replace(/\{\{\{([^}]+)}}}/g,function(){return n[arguments[1]]});s=s.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(n[arguments[1]])}),n.message=s}}function ve(n,i){var s,e;try{s=ne(n,i&&i.recover),e=s.errors,delete s.errors}catch(f){throw Ve(f),f}var t=He(h),r=new Date;return t.bind("now",x(function(f,o){return Y.fromMillis(r.getTime(),f,o)},"<s?s?:s>")),t.bind("millis",x(function(){return r.getTime()},"<:n>")),i&&i.RegexEngine?ve.RegexEngine=i.RegexEngine:ve.RegexEngine=RegExp,{evaluate:async function(f,o,d){if(typeof e<"u"){var A={code:"S0500",position:0};throw Ve(A),A}if(typeof o<"u"){var N;N=He(t);for(var W in o)N.bind(W,o[W])}else N=t;N.bind("$",f),r=new Date,N.timestamp=r,Array.isArray(f)&&!q(f)&&(f=_(f),f.outerWrapper=!0);var ge;try{return ge=await O(s,f,N),typeof d=="function"&&d(null,ge),ge}catch(te){throw Ve(te),te}},assign:function(f,o){t.bind(f,o)},registerFunction:function(f,o,d){var A=x(o,d);t.bind(f,A)},ast:function(){return s},errors:function(){return e}}}return ve.parser=ne,ve}();P.exports=M},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(S,P,z){var Y=S("./signature");const p=(()=>{var $={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},ne={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},Z=function(b){var g=0,m=b.length,_=function(me,B){var w={type:me,value:B,position:g};return w},q=function(){for(var me=g,B=0,w,J,C=function(O){if(b.charAt(O)==="/"&&B===0){for(var U=0;b.charAt(O-(U+1))==="\\";)U++;if(U%2===0)return!0}return!1};g<m;){var h=b.charAt(g);if(C(g)){if(w=b.substring(me,g),w==="")throw{code:"S0301",stack:new Error().stack,position:g};for(g++,h=b.charAt(g),me=g;h==="i"||h==="m";)g++,h=b.charAt(g);return J=b.substring(me,g)+"g",new RegExp(w,J)}(h==="("||h==="["||h==="{")&&b.charAt(g-1)!=="\\"&&B++,(h===")"||h==="]"||h==="}")&&b.charAt(g-1)!=="\\"&&B--,g++}throw{code:"S0302",stack:new Error().stack,position:g}},we=function(me){if(g>=m)return null;for(var B=b.charAt(g);g<m&&` 	
\r\v`.indexOf(B)>-1;)g++,B=b.charAt(g);if(B==="/"&&b.charAt(g+1)==="*"){var w=g;for(g+=2,B=b.charAt(g);!(B==="*"&&b.charAt(g+1)==="/");)if(B=b.charAt(++g),g>=m)throw{code:"S0106",stack:new Error().stack,position:w};return g+=2,B=b.charAt(g),we(me)}if(me!==!0&&B==="/")return g++,_("regex",q());if(B==="."&&b.charAt(g+1)===".")return g+=2,_("operator","..");if(B===":"&&b.charAt(g+1)==="=")return g+=2,_("operator",":=");if(B==="!"&&b.charAt(g+1)==="=")return g+=2,_("operator","!=");if(B===">"&&b.charAt(g+1)==="=")return g+=2,_("operator",">=");if(B==="<"&&b.charAt(g+1)==="=")return g+=2,_("operator","<=");if(B==="*"&&b.charAt(g+1)==="*")return g+=2,_("operator","**");if(B==="~"&&b.charAt(g+1)===">")return g+=2,_("operator","~>");if(Object.prototype.hasOwnProperty.call($,B))return g++,_("operator",B);if(B==='"'||B==="'"){var J=B;g++;for(var C="";g<m;){if(B=b.charAt(g),B==="\\")if(g++,B=b.charAt(g),Object.prototype.hasOwnProperty.call(ne,B))C+=ne[B];else if(B==="u"){var h=b.substr(g+1,4);if(/^[0-9a-fA-F]+$/.test(h)){var O=parseInt(h,16);C+=String.fromCharCode(O),g+=4}else throw{code:"S0104",stack:new Error().stack,position:g}}else throw{code:"S0103",stack:new Error().stack,position:g,token:B};else{if(B===J)return g++,_("string",C);C+=B}g++}throw{code:"S0101",stack:new Error().stack,position:g}}var U=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,ee=U.exec(b.substring(g));if(ee!==null){var ue=parseFloat(ee[0]);if(!isNaN(ue)&&isFinite(ue))return g+=ee[0].length,_("number",ue);throw{code:"S0102",stack:new Error().stack,position:g,token:ee[0]}}var de;if(B==="`"){g++;var pe=b.indexOf("`",g);if(pe!==-1)return de=b.substring(g,pe),g=pe+1,_("name",de);throw g=m,{code:"S0105",stack:new Error().stack,position:g}}for(var ae=g,Ae;;)if(Ae=b.charAt(ae),ae===m||` 	
\r\v`.indexOf(Ae)>-1||Object.prototype.hasOwnProperty.call($,Ae)){if(b.charAt(g)==="$")return de=b.substring(g+1,ae),g=ae,_("variable",de);switch(de=b.substring(g,ae),g=ae,de){case"or":case"in":case"and":return _("operator",de);case"true":return _("value",!0);case"false":return _("value",!1);case"null":return _("value",null);default:return g===m&&de===""?null:_("name",de)}}else ae++};return we},M=function(b,g){var m,_,q={},we=[],me=function(){var a=[];m.id!=="(end)"&&a.push({type:m.type,value:m.value,position:m.position});for(var u=_();u!==null;)a.push(u),u=_();return a},B={nud:function(){var a={code:"S0211",token:this.value,position:this.position};if(g)return a.remaining=me(),a.type="error",we.push(a),a;throw a.stack=new Error().stack,a}},w=function(a,u){var F=q[a];return u=u||0,F?u>=F.lbp&&(F.lbp=u):(F=Object.create(B),F.id=F.value=a,F.lbp=u,q[a]=F),F},J=function(a){if(g){a.remaining=me(),we.push(a);var u=q["(error)"];return m=Object.create(u),m.error=a,m.type="(error)",m}else throw a.stack=new Error().stack,a},C=function(a,u){if(a&&m.id!==a){var F;m.id==="(end)"?F="S0203":F="S0202";var K={code:F,position:m.position,token:m.value,value:a};return J(K)}var ye=_(u);if(ye===null)return m=q["(end)"],m.position=b.length,m;var ce=ye.value,c=ye.type,v;switch(c){case"name":case"variable":v=q["(name)"];break;case"operator":if(v=q[ce],!v)return J({code:"S0204",stack:new Error().stack,position:ye.position,token:ce});break;case"string":case"number":case"value":v=q["(literal)"];break;case"regex":c="regex",v=q["(regex)"];break;default:return J({code:"S0205",stack:new Error().stack,position:ye.position,token:ce})}return m=Object.create(v),m.value=ce,m.type=c,m.position=ye.position,m},h=function(a){var u,F=m;for(C(null,!0),u=F.nud();a<m.lbp;)F=m,C(),u=F.led(u);return u},O=function(a){var u=w(a,0);u.nud=function(){return this}},U=function(a,u,F){var K=u||$[a],ye=w(a,K);return ye.led=F||function(ce){return this.lhs=ce,this.rhs=h(K),this.type="binary",this},ye},ee=function(a,u,F){var K=w(a,u);return K.led=F,K},ue=function(a,u){var F=w(a);return F.nud=u||function(){return this.expression=h(70),this.type="unary",this},F};O("(end)"),O("(name)"),O("(literal)"),O("(regex)"),w(":"),w(";"),w(","),w(")"),w("]"),w("}"),w(".."),U("."),U("+"),U("-"),U("*"),U("/"),U("%"),U("="),U("<"),U(">"),U("!="),U("<="),U(">="),U("&"),U("and"),U("or"),U("in"),O("and"),O("or"),O("in"),ue("-"),U("~>"),ee("(error)",10,function(a){return this.lhs=a,this.error=m.error,this.remaining=me(),this.type="error",this}),ue("*",function(){return this.type="wildcard",this}),ue("**",function(){return this.type="descendant",this}),ue("%",function(){return this.type="parent",this}),U("(",$["("],function(a){if(this.procedure=a,this.type="function",this.arguments=[],m.id!==")")for(;m.type==="operator"&&m.id==="?"?(this.type="partial",this.arguments.push(m),C("?")):this.arguments.push(h(0)),m.id===",";)C(",");if(C(")",!0),a.type==="name"&&(a.value==="function"||a.value==="Î»")){if(this.arguments.forEach(function(ce,c){if(ce.type!=="variable")return J({code:"S0208",stack:new Error().stack,position:ce.position,token:ce.value,value:c+1})}),this.type="lambda",m.id==="<"){for(var u=m.position,F=1,K="<";F>0&&m.id!=="{"&&m.id!=="(end)";){var ye=C();ye.id===">"?F--:ye.id==="<"&&F++,K+=ye.value}C(">");try{this.signature=Y(K)}catch(ce){return ce.position=u+ce.offset,J(ce)}}C("{"),this.body=h(0),C("}")}return this}),ue("(",function(){for(var a=[];m.id!==")"&&(a.push(h(0)),m.id===";");)C(";");return C(")",!0),this.type="block",this.expressions=a,this}),ue("[",function(){var a=[];if(m.id!=="]")for(;;){var u=h(0);if(m.id===".."){var F={type:"binary",value:"..",position:m.position,lhs:u};C(".."),F.rhs=h(0),u=F}if(a.push(u),m.id!==",")break;C(",")}return C("]",!0),this.expressions=a,this.type="unary",this}),U("[",$["["],function(a){if(m.id==="]"){for(var u=a;u&&u.type==="binary"&&u.value==="[";)u=u.lhs;return u.keepArray=!0,C("]"),a}else return this.lhs=a,this.rhs=h($["]"]),this.type="binary",C("]",!0),this}),U("^",$["^"],function(a){C("(");for(var u=[];;){var F={descending:!1};if(m.id==="<"?C("<"):m.id===">"&&(F.descending=!0,C(">")),F.expression=h(0),u.push(F),m.id!==",")break;C(",")}return C(")"),this.lhs=a,this.rhs=u,this.type="binary",this});var de=function(a){var u=[];if(m.id!=="}")for(;;){var F=h(0);C(":");var K=h(0);if(u.push([F,K]),m.id!==",")break;C(",")}return C("}",!0),typeof a>"u"?(this.lhs=u,this.type="unary"):(this.lhs=a,this.rhs=u,this.type="binary"),this};ue("{",de),U("{",$["{"],de),ee(":=",$[":="],function(a){return a.type!=="variable"?J({code:"S0212",stack:new Error().stack,position:a.position,token:a.value}):(this.lhs=a,this.rhs=h($[":="]-1),this.type="binary",this)}),U("@",$["@"],function(a){return this.lhs=a,this.rhs=h($["@"]),this.rhs.type!=="variable"?J({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),U("#",$["#"],function(a){return this.lhs=a,this.rhs=h($["#"]),this.rhs.type!=="variable"?J({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),U("?",$["?"],function(a){return this.type="condition",this.condition=a,this.then=h(0),m.id===":"&&(C(":"),this.else=h(0)),this}),ue("|",function(){return this.type="transform",this.pattern=h(0),C("|"),this.update=h(0),m.id===","&&(C(","),this.delete=h(0)),C("|"),this});var pe=function(a){var u;if(a.type==="function"&&!a.predicate){var F={type:"lambda",thunk:!0,arguments:[],position:a.position};F.body=a,u=F}else if(a.type==="condition")a.then=pe(a.then),typeof a.else<"u"&&(a.else=pe(a.else)),u=a;else if(a.type==="block"){var K=a.expressions.length;K>0&&(a.expressions[K-1]=pe(a.expressions[K-1])),u=a}else u=a;return u},ae=0,Ae=0,Re=[],fe=function(a,u){switch(a.type){case"name":case"wildcard":u.level--,u.level===0&&(typeof a.ancestor>"u"||(Re[u.index].slot.label=a.ancestor.label),a.ancestor=u,a.tuple=!0);break;case"parent":u.level++;break;case"block":a.expressions.length>0&&(a.tuple=!0,u=fe(a.expressions[a.expressions.length-1],u));break;case"path":a.tuple=!0;var F=a.steps.length-1;for(u=fe(a.steps[F--],u);u.level>0&&F>=0;)u=fe(a.steps[F--],u);break;default:throw{code:"S0217",token:a.type,position:a.position}}return u},X=function(a,u){if(typeof u.seekingParent<"u"||u.type==="parent"){var F=typeof u.seekingParent<"u"?u.seekingParent:[];u.type==="parent"&&F.push(u.slot),typeof a.seekingParent>"u"?a.seekingParent=F:Array.prototype.push.apply(a.seekingParent,F)}},ze=function(a){var u=a.steps.length-1,F=a.steps[u],K=typeof F.seekingParent<"u"?F.seekingParent:[];F.type==="parent"&&K.push(F.slot);for(var ye=0;ye<K.length;ye++){var ce=K[ye];for(u=a.steps.length-2;ce.level>0;){if(u<0){typeof a.seekingParent>"u"?a.seekingParent=[ce]:a.seekingParent.push(ce);break}for(var c=a.steps[u--];u>=0&&c.focus&&a.steps[u].focus;)c=a.steps[u--];ce=fe(c,ce)}}},V=function(a){var u;switch(a.type){case"binary":switch(a.value){case".":var F=V(a.lhs);F.type==="path"?u=F:u={type:"path",steps:[F]},F.type==="parent"&&(u.seekingParent=[F.slot]);var K=V(a.rhs);K.type==="function"&&K.procedure.type==="path"&&K.procedure.steps.length===1&&K.procedure.steps[0].type==="name"&&u.steps[u.steps.length-1].type==="function"&&(u.steps[u.steps.length-1].nextFunction=K.procedure.steps[0].value),K.type==="path"?Array.prototype.push.apply(u.steps,K.steps):(typeof K.predicate<"u"&&(K.stages=K.predicate,delete K.predicate),u.steps.push(K)),u.steps.filter(function(T){if(T.type==="number"||T.type==="value")throw{code:"S0213",stack:new Error().stack,position:T.position,value:T.value};return T.type==="string"}).forEach(function(T){T.type="name"}),u.steps.filter(function(T){return T.keepArray===!0}).length>0&&(u.keepSingletonArray=!0);var ye=u.steps[0];ye.type==="unary"&&ye.value==="["&&(ye.consarray=!0);var ce=u.steps[u.steps.length-1];ce.type==="unary"&&ce.value==="["&&(ce.consarray=!0),ze(u);break;case"[":u=V(a.lhs);var c=u,v="predicate";if(u.type==="path"&&(c=u.steps[u.steps.length-1],v="stages"),typeof c.group<"u")throw{code:"S0209",stack:new Error().stack,position:a.position};typeof c[v]>"u"&&(c[v]=[]);var l=V(a.rhs);typeof l.seekingParent<"u"&&(l.seekingParent.forEach(T=>{T.level===1?fe(c,T):T.level--}),X(c,l)),c[v].push({type:"filter",expr:l,position:a.position});break;case"{":if(u=V(a.lhs),typeof u.group<"u")throw{code:"S0210",stack:new Error().stack,position:a.position};u.group={lhs:a.rhs.map(function(T){return[V(T[0]),V(T[1])]}),position:a.position};break;case"^":u=V(a.lhs),u.type!=="path"&&(u={type:"path",steps:[u]});var k={type:"sort",position:a.position};k.terms=a.rhs.map(function(T){var L=V(T.expression);return X(k,L),{descending:T.descending,expression:L}}),u.steps.push(k),ze(u);break;case":=":u={type:"bind",value:a.value,position:a.position},u.lhs=V(a.lhs),u.rhs=V(a.rhs),X(u,u.rhs);break;case"@":if(u=V(a.lhs),c=u,u.type==="path"&&(c=u.steps[u.steps.length-1]),typeof c.stages<"u"||typeof c.predicate<"u")throw{code:"S0215",stack:new Error().stack,position:a.position};if(c.type==="sort")throw{code:"S0216",stack:new Error().stack,position:a.position};a.keepArray&&(c.keepArray=!0),c.focus=a.rhs.value,c.tuple=!0;break;case"#":u=V(a.lhs),c=u,u.type==="path"?c=u.steps[u.steps.length-1]:(u={type:"path",steps:[u]},typeof c.predicate<"u"&&(c.stages=c.predicate,delete c.predicate)),typeof c.stages>"u"?c.index=a.rhs.value:c.stages.push({type:"index",value:a.rhs.value,position:a.position}),c.tuple=!0;break;case"~>":u={type:"apply",value:a.value,position:a.position},u.lhs=V(a.lhs),u.rhs=V(a.rhs);break;default:u={type:a.type,value:a.value,position:a.position},u.lhs=V(a.lhs),u.rhs=V(a.rhs),X(u,u.lhs),X(u,u.rhs)}break;case"unary":u={type:a.type,value:a.value,position:a.position},a.value==="["?u.expressions=a.expressions.map(function(T){var L=V(T);return X(u,L),L}):a.value==="{"?u.lhs=a.lhs.map(function(T){var L=V(T[0]);X(u,L);var re=V(T[1]);return X(u,re),[L,re]}):(u.expression=V(a.expression),a.value==="-"&&u.expression.type==="number"?(u=u.expression,u.value=-u.value):X(u,u.expression));break;case"function":case"partial":u={type:a.type,name:a.name,value:a.value,position:a.position},u.arguments=a.arguments.map(function(T){var L=V(T);return X(u,L),L}),u.procedure=V(a.procedure);break;case"lambda":u={type:a.type,arguments:a.arguments,signature:a.signature,position:a.position};var D=V(a.body);u.body=pe(D);break;case"condition":u={type:a.type,position:a.position},u.condition=V(a.condition),X(u,u.condition),u.then=V(a.then),X(u,u.then),typeof a.else<"u"&&(u.else=V(a.else),X(u,u.else));break;case"transform":u={type:a.type,position:a.position},u.pattern=V(a.pattern),u.update=V(a.update),typeof a.delete<"u"&&(u.delete=V(a.delete));break;case"block":u={type:a.type,position:a.position},u.expressions=a.expressions.map(function(T){var L=V(T);return X(u,L),(L.consarray||L.type==="path"&&L.steps[0].consarray)&&(u.consarray=!0),L});break;case"name":u={type:"path",steps:[a]},a.keepArray&&(u.keepSingletonArray=!0);break;case"parent":u={type:"parent",slot:{label:"!"+ae++,level:1,index:Ae++}},Re.push(u);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":u=a;break;case"operator":if(a.value==="and"||a.value==="or"||a.value==="in")a.type="name",u=V(a);else if(a.value==="?")u=a;else throw{code:"S0201",stack:new Error().stack,position:a.position,token:a.value};break;case"error":u=a,a.lhs&&(u=V(a.lhs));break;default:var E="S0206";a.id==="(end)"&&(E="S0207");var y={code:E,position:a.position,token:a.value};if(g)return we.push(y),{type:"error",error:y};throw y.stack=new Error().stack,y}return a.keepArray&&(u.keepArray=!0),u};_=Z(b),C();var Te=h(0);if(m.id!=="(end)"){var qe={code:"S0201",position:m.position,token:m.value};J(qe)}if(Te=V(Te),Te.type==="parent"||typeof Te.seekingParent<"u")throw{code:"S0217",token:Te.type,position:Te.position};return we.length>0&&(Te.errors=we),Te};return M})();P.exports=p},{"./signature":5}],5:[function(S,P,z){var Y=S("./utils");const p=(()=>{var $={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function ne(Z){for(var M=1,b=[],g={},m=g;M<Z.length;){var _=Z.charAt(M);if(_===":")break;var q=function(){b.push(g),m=g,g={}},we=function(U,ee,ue,de){for(var pe=1,ae=ee;ae<U.length;)if(ae++,_=U.charAt(ae),_===de){if(pe--,pe===0)break}else _===ue&&pe++;return ae};switch(_){case"s":case"n":case"b":case"l":case"o":g.regex="["+_+"m]",g.type=_,q();break;case"a":g.regex="[asnblfom]",g.type=_,g.array=!0,q();break;case"f":g.regex="f",g.type=_,q();break;case"j":g.regex="[asnblom]",g.type=_,q();break;case"x":g.regex="[asnblfom]",g.type=_,q();break;case"-":m.context=!0,m.contextRegex=new RegExp(m.regex),m.regex+="?";break;case"?":case"+":m.regex+=_;break;case"(":var me=we(Z,M,"(",")"),B=Z.substring(M+1,me);if(B.indexOf("<")===-1)g.regex="["+B+"m]";else throw{code:"S0402",stack:new Error().stack,value:B,offset:M};g.type="("+B+")",M=me,q();break;case"<":if(m.type==="a"||m.type==="f"){var w=we(Z,M,"<",">");m.subtype=Z.substring(M+1,w),M=w}else throw{code:"S0401",stack:new Error().stack,value:m.type,offset:M};break}M++}var J="^"+b.map(function(U){return"("+U.regex+")"}).join("")+"$",C=new RegExp(J),h=function(U){var ee;if(Y.isFunction(U))ee="f";else{var ue=typeof U;switch(ue){case"string":ee="s";break;case"number":ee="n";break;case"boolean":ee="b";break;case"object":U===null?ee="l":Array.isArray(U)?ee="a":ee="o";break;case"undefined":default:ee="m"}}return ee},O=function(U,ee){for(var ue="^",de=0,pe=0;pe<b.length;pe++){ue+=b[pe].regex;var ae=ee.match(ue);if(ae===null)throw{code:"T0410",stack:new Error().stack,value:U[de],index:de+1};de=ae[0].length}throw{code:"T0410",stack:new Error().stack,value:U[de],index:de+1}};return{definition:Z,validate:function(U,ee){var ue="";U.forEach(function(Ae){ue+=h(Ae)});var de=C.exec(ue);if(de){var pe=[],ae=0;return b.forEach(function(Ae,Re){var fe=U[ae],X=de[Re+1];if(X==="")if(Ae.context&&Ae.contextRegex){var ze=h(ee);if(Ae.contextRegex.test(ze))pe.push(ee);else throw{code:"T0411",stack:new Error().stack,value:ee,index:ae+1}}else pe.push(fe),ae++;else X.split("").forEach(function(V){if(Ae.type==="a"){if(V==="m")fe=void 0;else{fe=U[ae];var Te=!0;if(typeof Ae.subtype<"u"){if(V!=="a"&&X!==Ae.subtype)Te=!1;else if(V==="a"&&fe.length>0){var qe=h(fe[0]);if(qe!==Ae.subtype.charAt(0))Te=!1;else{var a=fe.filter(function(u){return h(u)!==qe});Te=a.length===0}}}if(!Te)throw{code:"T0412",stack:new Error().stack,value:fe,index:ae+1,type:$[Ae.subtype]};V!=="a"&&(fe=[fe])}pe.push(fe),ae++}else pe.push(fe),ae++})}),pe}O(U,ue)}}}return ne})();P.exports=p},{"./utils":6}],6:[function(S,P,z){const Y=(()=>{function p(w){var J=!1;if(typeof w=="number"&&(J=!isNaN(w),J&&!isFinite(w)))throw{code:"D1001",value:w,stack:new Error().stack};return J}function $(w){var J=!1;return Array.isArray(w)&&(J=w.filter(function(C){return typeof C!="string"}).length===0),J}function ne(w){var J=!1;return Array.isArray(w)&&(J=w.filter(function(C){return!p(C)}).length===0),J}function Z(){var w=[];return w.sequence=!0,arguments.length===1&&w.push(arguments[0]),w}function M(w){return w.sequence===!0&&Array.isArray(w)}function b(w){return w&&(w._jsonata_function===!0||w._jsonata_lambda===!0)||typeof w=="function"}function g(w){var J=typeof w.arity=="number"?w.arity:typeof w.implementation=="function"?w.implementation.length:typeof w.length=="number"?w.length:w.arguments.length;return J}function m(w){return w&&w._jsonata_lambda===!0}var _=(typeof Symbol=="function"?Symbol:{}).iterator||"@@iterator";function q(w){return typeof w=="object"&&w!==null&&_ in w&&"next"in w&&typeof w.next=="function"}function we(w,J){if(w===J)return!0;if(typeof w=="object"&&typeof J=="object"&&w!==null&&J!==null){if(Array.isArray(w)&&Array.isArray(J)){if(w.length!==J.length)return!1;for(var C=0;C<w.length;C++)if(!we(w[C],J[C]))return!1;return!0}var h=Object.getOwnPropertyNames(w),O=Object.getOwnPropertyNames(J);if(h.length!==O.length)return!1;for(h=h.sort(),O=O.sort(),C=0;C<h.length;C++)if(h[C]!==O[C])return!1;for(C=0;C<h.length;C++){var U=h[C];if(!we(w[U],J[U]))return!1}return!0}return!1}function me(w){return typeof w=="object"&&w!==null&&"then"in w&&typeof w.then=="function"}function B(w){var J=[];for(let C of w)J.push(C);return J}return{isNumeric:p,isArrayOfStrings:$,isArrayOfNumbers:ne,createSequence:Z,isSequence:M,isFunction:b,isLambda:m,isIterable:q,getFunctionArity:g,isDeepEqual:we,stringToArray:B,isPromise:me}})();P.exports=Y},{}]},{},[3])(3)})})(qt);var nn=qt.exports;const rn=Xt(nn);function an(se){let j,S,P,z,Y,p,$;function ne(M){se[9](M)}let Z={lang:Mt(),theme:se[5]};return se[0]!==void 0&&(Z.value=se[0]),P=new Ft({props:Z}),Rt.push(()=>Lt(P,"value",ne)),p=new Wt({props:{message:se[3]}}),{c(){j=ht("div"),S=ht("div"),Xe(P.$$.fragment),Y=$t(),Xe(p.$$.fragment),this.h()},l(M){j=vt(M,"DIV",{slot:!0,class:!0});var b=gt(j);S=vt(b,"DIV",{class:!0});var g=gt(S);Ke(P.$$.fragment,g),g.forEach(Je),Y=Ct(b),Ke(p.$$.fragment,b),b.forEach(Je),this.h()},h(){st(S,"class","codemirror-outer-wrapper svelte-1c1dcsz"),st(j,"slot","left"),st(j,"class","svelte-1c1dcsz")},m(M,b){xt(M,j,b),kt(j,S),et(P,S,null),kt(j,Y),et(p,j,null),$=!0},p(M,b){const g={};b&32&&(g.theme=M[5]),!z&&b&1&&(z=!0,g.value=M[0],zt(()=>z=!1)),P.$set(g);const m={};b&8&&(m.message=M[3]),p.$set(m)},i(M){$||(tt(P.$$.fragment,M),tt(p.$$.fragment,M),$=!0)},o(M){nt(P.$$.fragment,M),nt(p.$$.fragment,M),$=!1},d(M){M&&Je(j),rt(P),rt(p)}}}function on(se){let j,S,P,z,Y,p,$;function ne(M){se[8](M)}let Z={lang:Mt(),theme:se[5],lineWrapping:!0};return se[1]!==void 0&&(Z.value=se[1]),P=new Ft({props:Z}),Rt.push(()=>Lt(P,"value",ne)),p=new Wt({props:{message:se[4]}}),{c(){j=ht("div"),S=ht("div"),Xe(P.$$.fragment),Y=$t(),Xe(p.$$.fragment),this.h()},l(M){j=vt(M,"DIV",{class:!0});var b=gt(j);S=vt(b,"DIV",{class:!0});var g=gt(S);Ke(P.$$.fragment,g),g.forEach(Je),Y=Ct(b),Ke(p.$$.fragment,b),b.forEach(Je),this.h()},h(){st(S,"class","codemirror-outer-wrapper jsonata svelte-1c1dcsz"),st(j,"class","jsonata-wrapper svelte-1c1dcsz")},m(M,b){xt(M,j,b),kt(j,S),et(P,S,null),kt(j,Y),et(p,j,null),$=!0},p(M,b){const g={};b&32&&(g.theme=M[5]),!z&&b&2&&(z=!0,g.value=M[1],zt(()=>z=!1)),P.$set(g);const m={};b&16&&(m.message=M[4]),p.$set(m)},i(M){$||(tt(P.$$.fragment,M),tt(p.$$.fragment,M),$=!0)},o(M){nt(P.$$.fragment,M),nt(p.$$.fragment,M),$=!1},d(M){M&&Je(j),rt(P),rt(p)}}}function sn(se){let j,S,P;return S=new Ft({props:{value:se[2],lang:Mt(),theme:se[5],lineWrapping:!0,readonly:!0}}),{c(){j=ht("div"),Xe(S.$$.fragment),this.h()},l(z){j=vt(z,"DIV",{class:!0});var Y=gt(j);Ke(S.$$.fragment,Y),Y.forEach(Je),this.h()},h(){st(j,"class","codemirror-outer-wrapper result svelte-1c1dcsz")},m(z,Y){xt(z,j,Y),et(S,j,null),P=!0},p(z,Y){const p={};Y&4&&(p.value=z[2]),Y&32&&(p.theme=z[5]),S.$set(p)},i(z){P||(tt(S.$$.fragment,z),P=!0)},o(z){nt(S.$$.fragment,z),P=!1},d(z){z&&Je(j),rt(S)}}}function un(se){let j,S,P,z,Y;return S=new It({props:{title:"JSONata",hasPadding:!1,$$slots:{default:[on]},$$scope:{ctx:se}}}),z=new It({props:{title:"Result",hasPadding:!1,isCompact:!0,isCollapsible:!1,fill:!0,$$slots:{default:[sn]},$$scope:{ctx:se}}}),{c(){j=ht("div"),Xe(S.$$.fragment),P=$t(),Xe(z.$$.fragment),this.h()},l(p){j=vt(p,"DIV",{slot:!0,class:!0});var $=gt(j);Ke(S.$$.fragment,$),P=Ct($),Ke(z.$$.fragment,$),$.forEach(Je),this.h()},h(){st(j,"slot","right"),st(j,"class","svelte-1c1dcsz")},m(p,$){xt(p,j,$),et(S,j,null),kt(j,P),et(z,j,null),Y=!0},p(p,$){const ne={};$&4146&&(ne.$$scope={dirty:$,ctx:p}),S.$set(ne);const Z={};$&4132&&(Z.$$scope={dirty:$,ctx:p}),z.$set(Z)},i(p){Y||(tt(S.$$.fragment,p),tt(z.$$.fragment,p),Y=!0)},o(p){nt(S.$$.fragment,p),nt(z.$$.fragment,p),Y=!1},d(p){p&&Je(j),rt(S),rt(z)}}}function fn(se){let j,S;return j=new tn({props:{leftTitle:"JSON text",hasPadding:!1,$$slots:{right:[un],left:[an]},$$scope:{ctx:se}}}),{c(){Xe(j.$$.fragment)},l(P){Ke(j.$$.fragment,P)},m(P,z){et(j,P,z),S=!0},p(P,z){const Y={};z&4159&&(Y.$$scope={dirty:z,ctx:P}),j.$set(Y)},i(P){S||(tt(j.$$.fragment,P),S=!0)},o(P){nt(j.$$.fragment,P),S=!1},d(P){rt(j,P)}}}function cn(se){let j,S;return j=new en({props:{$$slots:{default:[fn]},$$scope:{ctx:se}}}),{c(){Xe(j.$$.fragment)},l(P){Ke(j.$$.fragment,P)},m(P,z){et(j,P,z),S=!0},p(P,[z]){const Y={};z&4159&&(Y.$$scope={dirty:z,ctx:P}),j.$set(Y)},i(P){S||(tt(j.$$.fragment,P),S=!0)},o(P){nt(j.$$.fragment,P),S=!1},d(P){rt(j,P)}}}function ln(se,j,S){let P;Jt(se,Kt,q=>S(5,P=q));let z=JSON.stringify(JSON.parse('{"Account":{"Account Name":"Firefly","Order":[{"OrderID":"order103","Product":[{"Product Name":"Bowler Hat","ProductID":858383,"SKU":"0406654608","Description":{"Colour":"Purple","Width":300,"Height":200,"Depth":210,"Weight":0.75},"Price":34.45,"Quantity":2},{"Product Name":"Trilby hat","ProductID":858236,"SKU":"0406634348","Description":{"Colour":"Orange","Width":300,"Height":200,"Depth":210,"Weight":0.6},"Price":21.67,"Quantity":1}]},{"OrderID":"order104","Product":[{"Product Name":"Bowler Hat","ProductID":858383,"SKU":"040657863","Description":{"Colour":"Purple","Width":300,"Height":200,"Depth":210,"Weight":0.75},"Price":34.45,"Quantity":4},{"ProductID":345664,"SKU":"0406654603","Product Name":"Cloak","Description":{"Colour":"Black","Width":30,"Height":20,"Depth":210,"Weight":2},"Price":107.99,"Quantity":1}]}]}}'),null,4),Y="$sum(Account.Order.Product.(Price * Quantity))",p="",$,ne,Z,M;function b(q){S(2,p=JSON.stringify(q,null,4))}function g(q){console.warn(q),S(2,p=""),S(4,M=`${q.code}: ${q.message} at position ${q.position}`)}function m(q){Y=q,S(1,Y)}function _(q){z=q,S(0,z)}return se.$$.update=()=>{if(se.$$.dirty&1)try{S(6,$=JSON.parse(z))}catch(q){S(3,Z=q.message)}if(se.$$.dirty&2)try{S(7,ne=rn(Y))}catch(q){g(q)}se.$$.dirty&192&&$&&ne&&ne.evaluate($).catch(q=>g(q)).then(q=>b(q))},[z,Y,p,Z,M,P,$,ne,m,_]}class kn extends Zt{constructor(j){super(),Qt(this,j,ln,cn,Vt,{})}}export{kn as component};
